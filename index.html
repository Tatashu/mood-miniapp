<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</title>
  <script src="https://js.telegram.org/bot/api.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --text: var(--tg-theme-text-color, #e2e8f0);
      --hint: var(--tg-theme-hint-color, #94a3b8);
      --bg: var(--tg-theme-bg-color, #0f172a);
    }
    body {
      background: var(--bg);
      color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 24px 16px;
      overflow: hidden;
    }
    .title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 32px;
      opacity: 0.85;
      text-align: center;
    }

    /* –û—Å–Ω–æ–≤–Ω–æ–π –∫—Ä—É–≥ */
    .mood-circle {
      position: relative;
      width: 280px;
      height: 280px;
      border-radius: 50%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      background: conic-gradient(
        from 90deg at 50% 50%,
        /* 0‚Äì19: —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π */
        #c084fc 0%,
        #a78bfa 19%,
        /* 20‚Äì59: –ø–µ—Ä–µ—Ö–æ–¥ */
        #a78bfa 20%,
        #60a5fa 35%,
        #38bdf8 59%,
        /* 60‚Äì100: –±–∏—Ä—é–∑–æ–≤—ã–π */
        #38bdf8 60%,
        #22d3ee 80%,
        #06b6d4 100%
      );
      border: 1px solid rgba(148, 163, 184, 0.15);
      box-shadow:
        0 8px 24px rgba(0,0,0,0.2),
        inset 0 0 0 1px rgba(255,255,255,0.03);
      cursor: ns-resize;
      transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1),
                  box-shadow 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    }

    /* –ú—è–≥–∫–∞—è –ø—É–ª—å—Å–∞—Ü–∏—è */
    @keyframes soft-pulse {
      0% { transform: scale(1); box-shadow: 0 8px 24px rgba(0,0,0,0.2), inset 0 0 0 1px rgba(255,255,255,0.03); }
      50% { transform: scale(1.02); box-shadow: 0 10px 30px rgba(0,0,0,0.25), 0 0 0 12px rgba(139, 92, 246, 0.15); }
      100% { transform: scale(1); }
    }
    .mood-circle.pulse {
      animation: soft-pulse 0.9s cubic-bezier(0.2, 0.8, 0.4, 1);
    }

    /* –ö–æ–Ω—Ç–µ–Ω—Ç –≤–Ω—É—Ç—Ä–∏ */
    .center {
      text-align: center;
      z-index: 2;
      pointer-events: none;
    }
    .emoji {
      font-size: 72px;
      line-height: 1;
      margin-bottom: 6px;
    }
    .value {
      font-size: 28px;
      font-weight: 700;
      background: linear-gradient(90deg, #ffffff, #c084fc);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    button {
      background: rgba(30, 41, 59, 0.5);
      color: white;
      border: 1px solid rgba(148, 163, 184, 0.2);
      border-radius: 16px;
      padding: 14px 32px;
      font-size: 17px;
      font-weight: 600;
      margin-top: 32px;
      cursor: pointer;
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      box-shadow: 0 4px 16px rgba(0,0,0,0.15);
      transition: all 0.25s ease;
    }
    button:hover { transform: translateY(-2px); }
    button:active { transform: translateY(0) scale(0.99); }

    .status {
      margin-top: 18px;
      font-size: 14px;
      color: var(--hint);
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="title">–ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ?</div>

  <div class="mood-circle" id="moodCircle">
    <div class="center">
      <div class="emoji" id="emoji">üôÇ</div>
      <div class="value" id="value">50</div>
    </div>
  </div>

  <button id="saveBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
  <div class="status" id="status"></div>

  <script>
    const tg = window.Telegram?.WebApp;
    if (tg) {
      tg.expand();
      tg.ready();
      tg.setBackgroundColor('#0f172a');
    }

    // DOM
    const moodCircle = document.getElementById('moodCircle');
    const emojiEl = document.getElementById('emoji');
    const valueEl = document.getElementById('value');
    const saveBtn = document.getElementById('saveBtn');
    const statusEl = document.getElementById('status');

    // –°–æ—Å—Ç–æ—è–Ω–∏–µ
    let moodValue = 50;
    let startY = 0;
    let isDragging = false;

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
    function updateUI() {
      // –ü–æ–∑–∏—Ü–∏—è –∑–∞–ª–∏–≤–∫–∏: –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –≥—Ä–∞–¥–∏–µ–Ω—Ç
      const angle = (moodValue / 100) * 360;
      moodCircle.style.background = `conic-gradient(
        from ${90 + angle}deg at 50% 50%,
        #c084fc 0%,
        #a78bfa 19%,
        #a78bfa 20%,
        #60a5fa 35%,
        #38bdf8 59%,
        #38bdf8 60%,
        #22d3ee 80%,
        #06b6d4 100%
      )`;

      // –°–º–∞–π–ª–∏–∫
      if (moodValue <= 19) emojiEl.textContent = 'üòû';
      else if (moodValue <= 39) emojiEl.textContent = 'üôÅ';
      else if (moodValue <= 59) emojiEl.textContent = 'üôÇ';
      else if (moodValue <= 79) emojiEl.textContent = 'üòÑ';
      else emojiEl.textContent = '‚ú®';

      valueEl.textContent = moodValue;

      // –ú—è–≥–∫–∞—è –ø—É–ª—å—Å–∞—Ü–∏—è (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏)
      if (isDragging) {
        moodCircle.classList.add('pulse');
        moodCircle.addEventListener('animationend', () => {
          moodCircle.classList.remove('pulse');
        }, { once: true });
      }
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
    function handleStart(clientY) {
      isDragging = true;
      startY = clientY;
    }

    function handleMove(clientY) {
      if (!isDragging) return;
      const dy = clientY - startY;
      // –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 2px = 1 –µ–¥–∏–Ω–∏—Ü–∞
      let newValue = moodValue - dy * 0.5;
      newValue = Math.min(100, Math.max(0, newValue));
      moodValue = Math.round(newValue);
      updateUI();
    }

    function handleEnd() {
      isDragging = false;
    }

    // Touch
    moodCircle.addEventListener('touchstart', (e) => {
      e.preventDefault();
      handleStart(e.touches[0].clientY);
    }, { passive: false });

    moodCircle.addEventListener('touchmove', (e) => {
      e.preventDefault();
      handleMove(e.touches[0].clientY);
    }, { passive: false });

    moodCircle.addEventListener('touchend', handleEnd);

    // Mouse
    moodCircle.addEventListener('mousedown', (e) => {
      handleStart(e.clientY);
      document.addEventListener('mousemove', (e) => handleMove(e.clientY));
      document.addEventListener('mouseup', () => {
        handleEnd();
        document.querySelectorAll('mousemove, mouseup').forEach(el => el.remove());
      }, { once: true });
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    updateUI();

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
    saveBtn.addEventListener('click', () => {
      const entries = JSON.parse(localStorage.getItem('mood_entries') || '[]');
      entries.push({
        date: new Date().toISOString().split('T')[0],
        mood: moodValue,
        timestamp: Date.now()
      });
      localStorage.setItem('mood_entries', JSON.stringify(entries));
      tg?.sendData?.(JSON.stringify({ action: 'mood', value: moodValue }));

      statusEl.textContent = '‚ú® –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ';
      saveBtn.disabled = true;
      setTimeout(() => {
        statusEl.textContent = '';
        saveBtn.disabled = false;
      }, 1800);
    });
  </script>
</body>
</html>

