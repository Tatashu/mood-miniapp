<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>–û–ø—Ä–æ—Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è ‚Äî Telegram Mini App</title>

<!-- –¢—ë–º–Ω–∞—è —Ç–µ–º–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é -->
<style>
  :root{
    --bg: #0b0f13;
    --card: rgba(255,255,255,0.04);
    --muted: #9aa6b2;
    --accent-start: #6ee7b7;
    --accent-end: #60a5fa;
    --glass: rgba(255,255,255,0.03);
    --glass-2: rgba(255,255,255,0.02);
    --glass-border: rgba(255,255,255,0.06);
    --glass-highlight: rgba(255,255,255,0.02);
    --text: #e6eef6;
    --success: #34d399;
    --danger: #fb7185;
    --max-width: 480px;
    --radius: 18px;
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }

  html,body{
    height:100%;
    margin:0;
    background: radial-gradient(1200px 600px at 10% 10%, rgba(96,165,250,0.07), transparent 10%),
                radial-gradient(800px 400px at 90% 90%, rgba(110,231,183,0.05), transparent 10%),
                var(--bg);
    color:var(--text);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  .wrap{
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:28px;
    box-sizing:border-box;
  }

  .card{
    width:100%;
    max-width:var(--max-width);
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius: calc(var(--radius) + 6px);
    padding:22px;
    box-sizing:border-box;
    box-shadow: 0 12px 30px rgba(2,6,23,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
    border: 1px solid var(--glass-border);
    backdrop-filter: blur(8px) saturate(1.05);
  }

  header{
    display:flex;
    gap:12px;
    align-items:center;
    margin-bottom:14px;
  }
  .logo{
    width:56px;
    height:56px;
    border-radius:14px;
    background: linear-gradient(135deg,var(--accent-start), var(--accent-end));
    display:flex;
    align-items:center;
    justify-content:center;
    box-shadow: 0 6px 18px rgba(96,165,250,0.12);
    font-weight:700;
    font-size:20px;
    color:#022;
  }
  h1{
    margin:0;
    font-size:18px;
    line-height:1.05;
    letter-spacing:-0.2px;
  }
  p.lead{
    margin:6px 0 0 0;
    color:var(--muted);
    font-size:13px;
  }

  .meter{
    margin-top:18px;
    display:flex;
    flex-direction:column;
    gap:14px;
    align-items:center;
  }

  /* —à–∫–∞–ª–∞ —Å–æ —Å–º–∞–π–ª–∏–∫–∞–º–∏ */
  .scale{
    width:100%;
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:10px;
    padding:10px;
    background: linear-gradient(180deg, var(--glass), transparent);
    border-radius:14px;
    border:1px solid var(--glass-border);
  }

  .mood-btn{
    --size:64px;
    width:var(--size);
    height:var(--size);
    display:inline-grid;
    place-items:center;
    border-radius:14px;
    cursor:pointer;
    user-select:none;
    background:transparent;
    border:none;
    transition:transform .18s cubic-bezier(.2,.9,.3,1), box-shadow .18s;
    outline: none;
    color:var(--text);
    font-size:28px;
  }
  .mood-btn:hover{ transform:translateY(-6px) scale(1.03); }
  .mood-btn:active{ transform:translateY(-2px) scale(0.99); }

  .mood-btn[aria-pressed="true"]{
    box-shadow: 0 10px 30px rgba(2,6,23,0.6), 0 6px 18px rgba(96,165,250,0.12);
    transform:translateY(-10px) scale(1.06);
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  }

  .labels{
    width:100%;
    display:flex;
    justify-content:space-between;
    margin-top:6px;
    color:var(--muted);
    font-size:12px;
    padding:0 2px;
  }

  .note{
    margin-top:12px;
    color:var(--muted);
    font-size:13px;
    text-align:center;
  }

  .controls{
    display:flex;
    gap:10px;
    margin-top:18px;
    justify-content:center;
    align-items:center;
  }

  .btn{
    min-width:120px;
    padding:10px 14px;
    border-radius:12px;
    border: 1px solid var(--glass-border);
    background: linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));
    color:var(--text);
    font-weight:600;
    cursor:pointer;
    transition: transform .12s, box-shadow .12s;
    outline:none;
  }
  .btn:active{ transform:translateY(2px); }
  .btn.primary{
    background: linear-gradient(90deg, var(--accent-start), var(--accent-end));
    color:#03202a;
    box-shadow: 0 8px 28px rgba(96,165,250,0.12);
    border: none;
  }
  .btn.ghost{
    background:transparent;
    color:var(--muted);
  }

  .saved{
    margin-top:14px;
    text-align:center;
    color:var(--muted);
    font-size:13px;
  }

  .time{
    font-size:12px;
    color:var(--muted);
  }

  /* –Ω–µ–±–æ–ª—å—à–∞—è –ø–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–Ω–æ–π —Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∫–∏ */
  .mood-btn:focus{
    box-shadow: 0 0 0 4px rgba(96,165,250,0.08), 0 6px 18px rgba(2,6,23,0.6);
  }

  @media (max-width:420px){
    .mood-btn{ --size:52px; font-size:24px; border-radius:12px; }
    .logo{ width:48px; height:48px; border-radius:12px; font-size:18px;}
  }
</style>
</head>
<body>
  <div class="wrap">
    <main class="card" role="main" aria-labelledby="title">
      <header>
        <div class="logo" aria-hidden="true">MH</div>
        <div>
          <h1 id="title">–ö–∞–∫ —Ç—ã —Å–µ–≥–æ–¥–Ω—è?</h1>
          <p class="lead">–ö–æ—Ä–æ—Ç–∫–∏–π –æ–ø—Ä–æ—Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è ‚Äî –ø–æ–¥–µ–ª–∏—Å—å, –∫–∞–∫ —Ç—ã —Å–µ–±—è —á—É–≤—Å—Ç–≤—É–µ—à—å</p>
        </div>
      </header>

      <section class="meter" aria-labelledby="meter-label">
        <div id="meter-label" class="time" style="width:100%; text-align:right;">‚Äî</div>

        <div class="scale" role="radiogroup" aria-label="–®–∫–∞–ª–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è">
          <!-- 5 –∫–Ω–æ–ø–æ–∫-—Å–º–∞–π–ª–∏–∫–æ–≤ -->
          <button class="mood-btn" data-value="1" aria-pressed="false" aria-label="–û—á–µ–Ω—å –ø–ª–æ—Ö–æ" title="–û—á–µ–Ω—å –ø–ª–æ—Ö–æ">üòñ</button>
          <button class="mood-btn" data-value="2" aria-pressed="false" aria-label="–ü–ª–æ—Ö–æ" title="–ü–ª–æ—Ö–æ">üòî</button>
          <button class="mood-btn" data-value="3" aria-pressed="false" aria-label="–ù–æ—Ä–º–∞–ª—å–Ω–æ" title="–ù–æ—Ä–º–∞–ª—å–Ω–æ">üòê</button>
          <button class="mood-btn" data-value="4" aria-pressed="false" aria-label="–•–æ—Ä–æ—à–æ" title="–•–æ—Ä–æ—à–æ">üôÇ</button>
          <button class="mood-btn" data-value="5" aria-pressed="false" aria-label="–û—Ç–ª–∏—á–Ω–æ" title="–û—Ç–ª–∏—á–Ω–æ">üòÑ</button>
        </div>

        <div class="labels" aria-hidden="true">
          <span>–û—á–µ–Ω—å –ø–ª–æ—Ö–æ</span>
          <span>–ü–ª–æ—Ö–æ</span>
          <span>–ù–æ—Ä–º–∞–ª—å–Ω–æ</span>
          <span>–•–æ—Ä–æ—à–æ</span>
          <span>–û—Ç–ª–∏—á–Ω–æ</span>
        </div>

        <p class="note">–ù–∞–∂–º–∏ —Å–º–∞–π–ª–∏–∫ –∏–ª–∏ –∫–ª–∞–≤–∏—à—É —Ü–∏—Ñ—Ä—ã 1‚Äì5. –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –∏ –º–æ–≥—É—Ç –±—ã—Ç—å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –±–æ—Ç—É.</p>

        <div class="controls" role="group" aria-label="–î–µ–π—Å—Ç–≤–∏—è">
          <button class="btn primary" id="saveBtn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
          <button class="btn ghost" id="clearBtn">–°–±—Ä–æ—Å–∏—Ç—å</button>
        </div>

        <div class="saved" id="status" aria-live="polite"></div>
      </section>
    </main>
  </div>

<script>
(function(){
  'use strict';

  // –≠–ª–µ–º–µ–Ω—Ç—ã
  const moodBtns = Array.from(document.querySelectorAll('.mood-btn'));
  const saveBtn = document.getElementById('saveBtn');
  const clearBtn = document.getElementById('clearBtn');
  const statusEl = document.getElementById('status');
  const timeEl = document.getElementById('meter-label');

  const STORAGE_KEY = 'tg_miniapp_mood_v1';

  // Helper: —Ñ–æ—Ä–º–∞—Ç –≤—Ä–µ–º–µ–Ω–∏
  function formatTime(ts){
    const d = new Date(ts);
    return d.toLocaleString('ru-RU', {
      year: 'numeric', month: 'short', day: 'numeric',
      hour: '2-digit', minute: '2-digit'
    });
  }

  // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π –∏–Ω–¥–µ–∫—Å
  function setSelected(value, announce=true){
    moodBtns.forEach(btn => {
      const pressed = String(btn.dataset.value) === String(value);
      btn.setAttribute('aria-pressed', pressed ? 'true' : 'false');
    });
    if (value === null || value === undefined) {
      statusEl.textContent = '';
      timeEl.textContent = '‚Äî';
      return;
    }
    // –ü–æ–∫–∞–∑–∞—Ç—å –≤—Ä–µ–º—è, –µ—Å–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ
    const now = Date.now();
    timeEl.textContent = '–í—ã–±—Ä–∞–Ω–æ: ' + formatTime(now);
    if (announce) statusEl.textContent = '–í—ã–±—Ä–∞–Ω–æ: ' + value + ' ‚Ä¢ –Ω–∞–∂–º–∏—Ç–µ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å"';
  }

 // –ü–æ–ª—É—á–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
  function getSelected(){
    const pressed = moodBtns.find(b => b.getAttribute('aria-pressed') === 'true');
    return pressed ? pressed.dataset.value : null;
  }

  // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ
  function saveLocal(payload){
    try{
      localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
    }catch(e){
      console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ localStorage', e);
    }
  }

  // –ó–∞–≥—Ä—É–∑–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ
  function loadLocal(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return null;
      return JSON.parse(raw);
    }catch(e){
      console.warn('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞', e);
      return null;
    }
  }

  // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ Telegram WebApp (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ) –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑–∞—Ç—å –≤ –∫–æ–Ω—Å–æ–ª–∏
  function sendToTelegram(data){
    // –ï—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ç–∫—Ä—ã—Ç–∞ –≤–Ω—É—Ç—Ä–∏ Telegram Web App
    if (window.Telegram && window.Telegram.WebApp && typeof window.Telegram.WebApp.sendData === 'function'){
      try{
        // sendData –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å—Ç—Ä–æ–∫—É; –±–æ—Ç –ø–æ–ª—É—á–∏—Ç –≤ update
        window.Telegram.WebApp.sendData(JSON.stringify(data));
        return {ok:true, via:'telegram.sendData'};
      }catch(err){
        console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —á–µ—Ä–µ–∑ Telegram.WebApp.sendData', err);
        return {ok:false, error: err};
      }
    } else {
      // fallback: –µ—Å–ª–∏ WebApp –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø–æ–ø—Ä–æ–±—É–µ–º window.parent.postMessage (–Ω–µ –≤—Å–µ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
      try {
        console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ (—ç–º—É–ª—è—Ü–∏—è) –¥–∞–Ω–Ω—ã—Ö:', data);
        statusEl.textContent = '–≠–º—É–ª—è—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏: –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ –∏ –≤—ã–≤–µ–¥–µ–Ω—ã –≤ –∫–æ–Ω—Å–æ–ª—å.';
        return {ok:true, via:'console'};
      } catch(err){
        console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ', err);
        return {ok:false, error: err};
      }
    }
  }

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫-—Å–º–∞–π–ª–∏–∫–æ–≤
  moodBtns.forEach((btn, idx) => {
    btn.addEventListener('click', () => {
      setSelected(btn.dataset.value);
      // —Ñ–æ–∫—É—Å –æ—Å—Ç–∞—ë—Ç—Å—è –Ω–∞ –∫–Ω–æ–ø–∫–µ
      btn.focus();
    });
    // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã: Enter/Space —É–∂–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –Ω–∞ click; –¥–æ–±–∞–≤–∏–º —Ü–∏—Ñ—Ä—ã
  });

  // –¶–∏—Ñ—Ä—ã 1-5 –¥–ª—è –≤—ã–±–æ—Ä–∞
  window.addEventListener('keydown', (e) => {
    if (e.target && /input|textarea/i.test(e.target.tagName)) return;
    if (/^[1-5]$/.test(e.key)){
      const val = e.key;
      const btn = moodBtns.find(b => b.dataset.value === val);
      if (btn){
        btn.click();
        e.preventDefault();
      }
    }
    // Enter –Ω–∞ –∫–Ω–æ–ø–∫–µ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å"
    if (e.key === 'Enter' && document.activeElement === saveBtn){
      saveBtn.click();
    }
  });

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ / –æ—Ç–ø—Ä–∞–≤–∫–∞
  saveBtn.addEventListener('click', () => {
    const val = getSelected();
    if (!val){
      statusEl.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ —Å–º–∞–π–ª–∏–∫ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π.';
      statusEl.style.color = 'var(--danger)';
      return;
    }
    const payload = {
      moodValue: Number(val),
      moodEmoji: moodBtns.find(b=>b.dataset.value==val)?.textContent || '',
      ts: Date.now(),
      tz: Intl.DateTimeFormat().resolvedOptions().timeZone || null,
      source: 'telegram_miniapp'
    };
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ –∏ –ø—ã—Ç–∞–µ–º—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å
    saveLocal(payload);
    const result = sendToTelegram(payload);
    if (result.ok){
      statusEl.style.color = 'var(--success)';
      statusEl.textContent = '–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ' + (result.via === 'telegram.sendData' ? ' –≤ Telegram.' : ' (—ç–º—É–ª—è—Ü–∏—è).');
    } else {
      statusEl.style.color = 'var(--danger)';
      statusEl.textContent = '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ ‚Äî –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ.';
    }
    timeEl.textContent = '–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ: ' + formatTime(payload.ts);
  });

  clearBtn.addEventListener('click', () => {
    localStorage.removeItem(STORAGE_KEY);
    setSelected(null);
    statusEl.style.color = 'var(--muted)';
    statusEl.textContent = '–î–∞–Ω–Ω—ã–µ —Å–±—Ä–æ—à–µ–Ω—ã.';
  });

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: –µ—Å–ª–∏ –µ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å
  (function initFromLocal(){
    const saved = loadLocal();
    if (saved && saved.moodValue){
      setSelected(String(saved.moodValue), false);
      timeEl.textContent = '–ü–æ—Å–ª–µ–¥–Ω—è—è –∑–∞–ø–∏—Å—å: ' + formatTime(saved.ts);
      statusEl.textContent = '–ï—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å (–ª–æ–∫–∞–ª—å–Ω–æ). –ù–∞–∂–º–∏—Ç–µ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å" –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –±–æ—Ç—É.';
    } else {
      setSelected(null, false);
      statusEl.textContent = '';
    }
  })();

  // –ü–æ–ø—ã—Ç–∫–∞ –ø–ª–∞–≤–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Telegram UI (–ø–æ–¥–∫—Ä—É—Ç–∏—Ç—å –∫–Ω–æ–ø–∫–∏ –≤–Ω–∏–∑—É web app)
  try {
    if (window.Telegram && window.Telegram.WebApp){
      const WebApp = window.Telegram.WebApp;
      // –ï—Å–ª–∏ —Ö–æ—Ç–∏–º –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä –ø–æ–¥ Telegram
      if (typeof WebApp.expand === 'function') {
        WebApp.expand(); // –ø–æ–ø—Ä–æ—Å–∏–º Telegram —Ä–∞—Å—à–∏—Ä–∏—Ç—å –æ–∫–Ω–æ (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
      }
      // –ù–∞—Å—Ç—Ä–æ–∏–º –≤–Ω–µ—à–Ω–∏–π –≤–∏–¥ –∫–Ω–æ–ø–∫–∏ –≤–Ω–∏–∑—É (–ø—Ä–∏–º–µ—Ä)
      if (WebApp.MainButton) {
        // –ø—Ä—è—á–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—É—é –∫–Ω–æ–ø–∫—É Telegram, —á—Ç–æ–±—ã –Ω–µ –º–µ—à–∞–ª–∞
        try { WebApp.MainButton.hide(); } catch(e) {}
      }
    }
  } catch(e){
    // –Ω–∏—á–µ–≥–æ
  }

})();
</script>
</body>
</html>
